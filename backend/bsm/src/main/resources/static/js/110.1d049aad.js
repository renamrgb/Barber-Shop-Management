"use strict";(self["webpackChunkbsm"]=self["webpackChunkbsm"]||[]).push([[110],{9068:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(1505);class r{url="/customers";async consultarTodos(){try{const e=await s.Z.get(this.url);return e.data}catch(e){return e}}async cadastrar(e){try{const t=await s.Z.post(this.url,this.replaceItem(e));return t}catch(t){return t}}async excluir(e){try{const t=await s.Z["delete"](`${this.url}/${e}`);return t}catch(t){return t}}async alterar(e,t){console.log(`${JSON.stringify(t)}`);try{const a=await s.Z.put(`${this.url}/${e}`,this.replaceItem(t));return a}catch(a){return console.log(a),a}}async buscarUm(e){try{const t=await s.Z.get(`${this.url}/${e}`);return t.data}catch(t){return t}}async findByName(e){try{const t=await s.Z.get(`${this.url}?name=${e}`);return t.data}catch(t){return t}}async getAllPaged(e){try{const t=await s.Z.get(`${this.url}/paged?page=${e}`);return t.data}catch(t){return t}}async getByNamePaged(e,t){try{const a=await s.Z.get(`${this.url}/paged?name=${e}&page=${t}`);return a.data}catch(a){return a}}replaceItem(e){return e.user.phoneNumber=e.user.phoneNumber.replace(/[^\d]+/g,""),e.user.document=e.user.document.replace(/[^\d]+/g,""),e.user.rg=e.user.rg.replace(/[^\d]+/g,""),void 0!=e.user.address.zipCode&&(e.user.address.zipCode=e.user.address.zipCode.replace(/[^\d]+/g,"")),e}}},1982:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(1505);class r{url="/paymentMethod";async consultarFormasPagamento(){try{const e=await s.Z.get(this.url);return e.data}catch(e){return e}}async getAllPaged(e){try{const t=await s.Z.get(`${this.url}/paged?page=${e}`);return t.data}catch(t){return t}}async cadastrar(e){try{const t=await s.Z.post(this.url,e);return t}catch(t){return t}}async excluir(e){try{const t=await s.Z["delete"](`${this.url}/${e}`);return t}catch(t){return t}}async alterar(e,t){try{const a=await s.Z.put(`${this.url}/${e}`,t);return a}catch(a){return a}}async buscarUmaformaDePagamento(e){try{const t=await s.Z.get(`${this.url}/${e}`);return t}catch(t){return t}}async getByDescription(e){try{const t=await s.Z.get(`${this.url}?description=${e}`);return t.data}catch(t){return t}}async getByDescriptionPaged(e,t){try{const a=await s.Z.get(`${this.url}/paged?description=${e}&page=${t}`);return a.data}catch(a){return a}}}},1466:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(1505);class r{url="/parameters";async getParamerter(){try{const e=await s.Z.get(`${this.url}/1`);return e.data}catch(e){return e}}async save(e){try{const t=await s.Z.put(`${this.url}/1`,e);return t.data}catch(t){return t}}async consultWorkSchedules(){try{const e=await s.Z.get(`${this.url}/1`);return e.data.parameterValues}catch(e){return e}}async getMaxPointsCard(){try{const e=await s.Z.get(`${this.url}/1`),t=e.data.parameterValues;for(let a of t)if("QTY_LOYALYTY_CARD"==a.parameter_key)return parseInt(a.parameter_value)}catch(e){return e}}async getParamerterKey(e){try{const t=await s.Z.get(`${this.url}/findByKey?pameterKey=${e}`);return t.data}catch(t){return t}}}},964:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(1505);class r{url="/products";async updateOrInsert(e,t){return void 0==e?await this.cadastrar(t):await this.alterar(e,t)}async consultarTodos(){try{const e=await s.Z.get(this.url);return e.data}catch(e){return e}}async getAllPaged(e,t){let a=`?page=${e}`;t&&(a=`?isActive=true&page=${e}`);try{const e=await s.Z.get(`${this.url}/productsPaged${a}`);return e.data}catch(r){return r}}async cadastrar(e){try{const t=await s.Z.post(this.url,e);return t}catch(t){return t}}async excluir(e){try{const t=await s.Z["delete"](`${this.url}/${e}`);return t}catch(t){return t}}async alterar(e,t){try{const a=await s.Z.put(`${this.url}/${e}`,t);return a}catch(a){return a}}async buscarUm(e){try{const t=await s.Z.get(`${this.url}/${e}`);return t.data}catch(t){return t}}async getByTitle(e){try{const t=await s.Z.get(`${this.url}?title=${e}`);return t.data}catch(t){return t}}async getByTitlePaged(e,t,a){let r="";a&&(r="&isActive=true");try{const a=await s.Z.get(`${this.url}/productsPaged?title=${e}${r}&page=${t}`);return a.data}catch(o){return o}}}},8387:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(1505),r=a(7853);class o{url="/schedules";procedimentoService=new r.Z;async searchAvailable(e,t){try{const a=await s.Z.get(`${this.url}/available?date=${e}&professionalId=${t}`);return a.data}catch(a){return a}}async save(e,t,a){try{let r=await this.calculateServiceTime(e.procedures);const o=this.setStartOrEndTime(t,a,r);e.startDate=o.startTime,e.endDate=o.endTime;const i=await s.Z.post(this.url,e);return i}catch(r){return r}}setStartOrEndTime(e,t,a){const[s,r,o]=t.split(":"),i=new Date(e),l=new Date(i.getFullYear(),i.getMonth(),i.getDate(),s,r,o);l.setDate(l.getDate()+1);const n=new Date(l.getTime()+6e4*a);return{startTime:l.toISOString().split("T")[0]+" "+l.toLocaleTimeString([],{hour12:!1}),endTime:n.toISOString().split("T")[0]+" "+n.toLocaleTimeString([],{hour12:!1})}}async calculateServiceTime(e){let t=0,a=await this.getTimes(e);for(const s of a)t=parseInt(t)+parseInt(this.converterParaMinutos(s));return t}async getTimes(e){let t,a=[];for(const s of e)t=await this.procedimentoService.buscarUm(s.id),a.push(t.duration);return a}converterParaMinutos(e){var t=e.split(":"),a=60*parseInt(t[0]),s=parseInt(t[1]),r=parseInt(t[2])/60,o=a+s+r;return o}async consultScheduledTimes(){try{const e=await s.Z.get(`${this.url}`);return e.data}catch(e){return e}}async getById(e){try{const t=await s.Z.get(`${this.url}/${e}`);return t.data}catch(t){return t}}async delete(e){try{const t=await s.Z["delete"](`${this.url}/${e}`);return t}catch(t){return t.response.data}}async update(e,t){try{t.endDate=t.endDate.replace("T"," "),t.startDate=t.startDate.replace("T"," ");const a=await s.Z.put(`${this.url}/${e}`,t);return a}catch(a){return a.response.data}}async finishService(e,t,a){try{t.endDate=t.endDate.replace("T"," "),t.startDate=t.startDate.replace("T"," "),t.payment=a;const r=await s.Z.put(`${this.url}/${e}`,t);return r}catch(r){return r.response.data}}async reverseService(e){try{const t=await s.Z.put(`${this.url}/reverseService/${e}`);return t}catch(t){return t.response.data}}}},5691:(e,t,a)=>{a.d(t,{Z:()=>s});class s{agora=(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"});dateNowISO(){const[e,t,a]=this.agora.split(/[\/\s,:]+/),s=`${a}-${t.padStart(2,"0")}-${e.padStart(2,"0")}`;return s}date(e,t,a){return"+"==a?e.setDate(e.getDate()+t):e.setDate(e.getDate()-t),this.formatDateISO(e.toLocaleString())}formatDateISO(e){const[t,a,s]=e.split(/[\/\s,:]+/),r=`${s}-${a.padStart(2,"0")}-${t.padStart(2,"0")}`;return r}compareDates(e){const t=new Date(e),a=new Date(this.formatDateISO(this.agora)),s=a.getTime()-t.getTime(),r=864e5,o=Math.floor(s/r);return o}}},5066:(e,t,a)=>{a.d(t,{Z:()=>d});var s=a(3396),r=a(7139);function o(e,t,a,o,i,l){const n=(0,s.up)("CToastBody"),d=(0,s.up)("CToast"),c=(0,s.up)("CToaster");return(0,s.wg)(),(0,s.j4)(c,{placement:"top-end"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.toasts,((e,t)=>((0,s.wg)(),(0,s.j4)(d,{key:t,color:i.color},{default:(0,s.w5)((()=>[(0,s.Wm)(n,null,{default:(0,s.w5)((()=>[(0,s._)("b",null,(0,r.zw)(e.content),1)])),_:2},1024)])),_:2},1032,["color"])))),128))])),_:1})}const i={data(){return{toasts:[],color:"info"}},methods:{createToast(e){this.color="light",this.toasts.push({content:e})},createToastDanger(e){this.color="danger",this.toasts.push({content:e})},createToastWarning(e){this.color="warning",this.toasts.push({content:e})}}};var l=a(89);const n=(0,l.Z)(i,[["render",o]]),d=n},7693:(e,t,a)=>{a.d(t,{Z:()=>w});var s=a(3396);const r={class:"row mb-3"},o={class:"col"},i={class:"col"},l={class:"row mb-3",style:{"text-align":"center"}},n={class:"col"},d={class:"col"},c={key:0,class:"row mb-3"},u={class:"col",style:{"text-align":"center"}};function m(e,t,a,m,p,h){const f=(0,s.up)("CButton"),v=(0,s.up)("CModalTitle"),y=(0,s.up)("CModalHeader"),g=(0,s.up)("CFormLabel"),w=(0,s.up)("CFormInput"),S=(0,s.up)("CModalBody"),_=(0,s.up)("CModalFooter"),b=(0,s.up)("CModal"),C=(0,s.up)("toast");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(f,{color:"secondary",variant:"outline",onClick:t[0]||(t[0]=()=>{p.visibleLiveDemo=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("Cartela de fidelidade")])),_:1}),(0,s.Wm)(b,{visible:p.visibleLiveDemo,onClose:t[4]||(t[4]=()=>{p.visibleLiveDemo=!1})},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Cartela de fidelidade")])),_:1})])),_:1}),(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s._)("div",o,[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Qtde de pontos")])),_:1}),(0,s.Wm)(w,{modelValue:a.card.points,"onUpdate:modelValue":t[1]||(t[1]=e=>a.card.points=e),disabled:!0},null,8,["modelValue"])]),(0,s._)("div",i,[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Qtde usos")])),_:1}),(0,s.Wm)(w,{modelValue:a.card.quantityUsed,"onUpdate:modelValue":t[2]||(t[2]=e=>a.card.quantityUsed=e),disabled:!0},null,8,["modelValue"])])]),(0,s._)("div",l,[(0,s._)("div",n,[(0,s.Wm)(f,{color:"link",shape:"rounded-0",onClick:h.resetCard},{default:(0,s.w5)((()=>[(0,s.Uk)("Zerar cartela")])),_:1},8,["onClick"])]),(0,s._)("div",d,[(0,s.Wm)(f,{color:"link",shape:"rounded-0",onClick:h.addPoints},{default:(0,s.w5)((()=>[(0,s.Uk)("Adicionar >>")])),_:1},8,["onClick"])])]),a.card.points==p.maxPoints?((0,s.wg)(),(0,s.iD)("div",c,[(0,s._)("div",u,[(0,s.Wm)(f,{color:"link",shape:"rounded-0",onClick:h.applyDiscount},{default:(0,s.w5)((()=>[(0,s.Uk)("Aplicar desconto")])),_:1},8,["onClick"])])])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f,{color:"secondary",onClick:t[3]||(t[3]=()=>{p.visibleLiveDemo=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)(" Fechar ")])),_:1})])),_:1})])),_:1},8,["visible"]),(0,s.Wm)(C,{ref:"toast"},null,512)],64)}var p=a(6947),h=a(1466),f=a(5066);const v={components:{CFormInput:p.jO,CFormLabel:p.L8,Toast:f.Z},name:"LoyaltyCard",props:{card:{type:Object,required:!0}},data(){return{visibleLiveDemo:!1,parameterService:new h.Z,maxPoints:0}},methods:{addPoints(){this.card.points<this.maxPoints?this.card.points=parseInt(this.card.points+1):this.$refs.toast.createToastDanger(`Os pontos não pode ser maior que ${this.maxPoints}`)},async getMaxPoints(){this.maxPoints=await this.parameterService.getMaxPointsCard()},resetCard(){this.card.points=0},async applyDiscount(){if(this.card.points==this.maxPoints){const e=await this.parameterService.getParamerterKey("DISCOUNT_LOYALYTY_CARD");this.$emit("apply-discount",parseFloat(e.parameter_value)),this.visibleLiveDemo=!1}else this.$refs.toast.createToastDanger(`Você só pode aplicar o desconto quando a quantidade de pontos for igual a ${this.maxPoints}`)}},mounted(){this.getMaxPoints()}};var y=a(89);const g=(0,y.Z)(v,[["render",m]]),w=g},4110:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ke});var s=a(3396),r=a(7139);const o={class:"row"},i={class:"col"},l={key:0,class:"col",style:{"text-align":"right"}},n={class:"row mb-3"},d={class:"col"},c={class:"col"},u={key:0,class:"row mb-3"},m={class:"col d-grid gap-2"},p={key:1},h={class:"row mb-3"},f={class:"col"},v={class:"col"},y={class:"row mb-3"},g={class:"col"},w=(0,s._)("span",{style:{"font-weight":"bold"}},"Tempo de atendimento:",-1),S={class:"col"},_=(0,s._)("span",{style:{"font-weight":"bold"}},"Valor dos procedimentos:",-1),b={class:"row"},C={class:"col"},$=(0,s._)("div",{class:"col"},null,-1),k={class:"row mb-3"},D={class:"col"},T=(0,s._)("div",{class:"col-auto"},[(0,s._)("a",{href:"/#/forms/cliente/cadastro",target:"_blank",class:"btn btn-secondary"},"Criar Cliente")],-1),W={key:0},P={key:0,class:"row mb-3"},Z={class:"row"},U={class:"col"},V={class:"col-5"},F={class:"col"},I={class:"col-4"},x={class:"col-1"},M={key:0,class:"bdr"},A=(0,s._)("span",{style:{"font-weight":"bold"}},"Total a ser pago: ",-1),q={key:1,class:"row mb-3"},O={class:"col"},B={class:"d-grid gap-2"},L={key:2},E={class:"row"},z={class:"col"},j={class:"row mb-3"},H={class:"col"},N={class:"row mb-3"},R={class:"col"},Y={class:"col"},K={class:"col"},Q={key:0,class:"row mb-3"},G={class:"col"},J={key:1,class:"row mb-3"},X=(0,s._)("div",{class:"col",style:{"text-align":"center",color:"red"}}," Atendimento Finalizado ",-1),ee=[X],te={key:1,class:"row mb-3"},ae=(0,s._)("div",{class:"col",style:{"text-align":"center",color:"red"}}," Você não pode adicionar produtos e finalizar o atendimento, ainda não está na data dele ",-1),se=[ae],re={class:"d-grid gap-2 d-md-flex justify-content-md-end"},oe=(0,s._)("a",{href:"/#/schedule/get",class:"btn btn-danger"},"Cancelar",-1);function ie(e,t,a,X,ae,ie){const le=(0,s.up)("CIcon"),ne=(0,s.up)("CCardHeader"),de=(0,s.up)("CFormLabel"),ce=(0,s.up)("CFormInput"),ue=(0,s.up)("v-select"),me=(0,s.up)("CButton"),pe=(0,s.up)("CFormSelect"),he=(0,s.up)("Multiselect"),fe=(0,s.up)("CInputGroup"),ve=(0,s.up)("CTableHeaderCell"),ye=(0,s.up)("CTableRow"),ge=(0,s.up)("CTableHead"),we=(0,s.up)("CTableDataCell"),Se=(0,s.up)("CTableBody"),_e=(0,s.up)("CTable"),be=(0,s.up)("CInputGroupText"),Ce=(0,s.up)("LoyaltyCard"),$e=(0,s.up)("CCardBody"),ke=(0,s.up)("CCard"),De=(0,s.up)("CCol"),Te=(0,s.up)("CRow"),We=(0,s.up)("toast"),Pe=(0,s.up)("ModalDelete");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(Te,null,{default:(0,s.w5)((()=>[(0,s.Wm)(De,{xs:12},{default:(0,s.w5)((()=>[(0,s.Wm)(ke,{class:"mb-4"},{default:(0,s.w5)((()=>[(0,s.Wm)(ne,null,{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("div",i,[(0,s._)("strong",null,(0,r.zw)(ie.titleCardHeader),1)]),void 0!=ae.id?((0,s.wg)(),(0,s.iD)("div",l,[(0,s.Wm)(le,{icon:"cil-trash",onClick:t[0]||(t[0]=e=>ie.toCallModalDele())})])):(0,s.kq)("",!0)])])),_:1}),(0,s.Wm)($e,null,{default:(0,s.w5)((()=>[(0,s._)("div",n,[(0,s._)("div",d,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Data do agendamento")])),_:1}),(0,s.Wm)(ce,{name:"Data da compra",type:"date",modelValue:ae.date,"onUpdate:modelValue":t[1]||(t[1]=e=>ae.date=e),onChange:t[2]||(t[2]=e=>ie.changeDate()),disabled:ae.disabled},null,8,["modelValue","disabled"])]),(0,s._)("div",c,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Profissional")])),_:1}),(0,s.Wm)(ue,{id:"selectV",modelValue:ae.profissionalSelected,"onUpdate:modelValue":t[3]||(t[3]=e=>ae.profissionalSelected=e),label:"label",options:ae.optionsSelectProfessional,input:ie.handleSelectChange(),disabled:ae.disabledById},null,8,["modelValue","options","input","disabled"])])]),void 0==ae.time&&void 0==ae.id?((0,s.wg)(),(0,s.iD)("div",u,[(0,s._)("div",m,[(0,s.Wm)(me,{color:"secondary",onClick:t[4]||(t[4]=e=>ie.searchValidation())},{default:(0,s.w5)((()=>[(0,s.Uk)("Buscar")])),_:1})])])):(0,s.kq)("",!0),ae.availableTimes.length>0||void 0!=ae.time||void 0!=ae.id?((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("div",h,[(0,s._)("div",f,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(ie.labelTimeAvaliabel),1)])),_:1}),(0,s.Wm)(pe,{options:ae.availableTimes,searchable:!0,modelValue:ae.startTime,"onUpdate:modelValue":t[5]||(t[5]=e=>ae.startTime=e),disabled:ae.disabled},null,8,["options","modelValue","disabled"])]),(0,s._)("div",v,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Procedimentos")])),_:1}),(0,s.Wm)(he,{modelValue:ae.proceduresSelected,"onUpdate:modelValue":t[6]||(t[6]=e=>ae.proceduresSelected=e),label:"description",trackBy:"description",options:ae.optionsSelectProcedures,searchable:!0,disabled:ae.isItFinished,mode:"tags"},null,8,["modelValue","options","disabled"])])]),(0,s._)("div",y,[(0,s._)("div",g,[w,(0,s.Uk)(" "+(0,r.zw)(ie.timeService),1)]),(0,s._)("div",S,[_,(0,s.Uk)(" "+(0,r.zw)(ie.priceProceduresSelected),1)])]),(0,s._)("div",b,[(0,s._)("div",C,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Cliente")])),_:1})]),$]),(0,s._)("div",k,[(0,s._)("div",D,[(0,s.Wm)(ue,{id:"selectV",modelValue:ae.customerSelected,"onUpdate:modelValue":t[7]||(t[7]=e=>ae.customerSelected=e),label:"label",options:ae.optionsSelectCustomer,disabled:ae.disabledById},null,8,["modelValue","options","disabled"])]),T]),ie.validForLaunchingProducts()||isFinite?((0,s.wg)(),(0,s.iD)("div",W,[void 0==ae.id||ae.isItFinished?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",Z,[(0,s._)("div",U,[(0,s.Wm)(de,{for:"nome"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Produto")])),_:1})]),(0,s._)("div",V,[(0,s.Wm)(de,{for:"price"},{default:(0,s.w5)((()=>[(0,s.Uk)("* Quantidade")])),_:1})])]),(0,s._)("div",F,[(0,s.Wm)(ue,{id:"selectV",modelValue:ae.productSelected,"onUpdate:modelValue":t[8]||(t[8]=e=>ae.productSelected=e),label:"label",options:ae.optionsSelectProduct},null,8,["modelValue","options"])]),(0,s._)("div",I,[(0,s.Wm)(fe,{class:"mb-1"},{default:(0,s.w5)((()=>[(0,s.Wm)(ce,{name:"quantidade",type:"number",modelValue:ae.product.quantity,"onUpdate:modelValue":t[9]||(t[9]=e=>ae.product.quantity=e),min:0},null,8,["modelValue"])])),_:1})]),(0,s._)("div",x,[(0,s.Wm)(me,{color:"info",shape:"rounded-pill",onClick:ie.addProduct},{default:(0,s.w5)((()=>[(0,s.Wm)(le,{icon:"cil-plus",size:"x"})])),_:1},8,["onClick"])]),ae.form.products.length>0?((0,s.wg)(),(0,s.iD)("div",M,[(0,s.Wm)(_e,{responsive:"xl"},{default:(0,s.w5)((()=>[(0,s.Wm)(ge,{class:"table-dark"},{default:(0,s.w5)((()=>[(0,s.Wm)(ye,null,{default:(0,s.w5)((()=>[(0,s.Wm)(ve,{scope:"col"},{default:(0,s.w5)((()=>[(0,s.Uk)("#")])),_:1}),(0,s.Wm)(ve,{scope:"col"},{default:(0,s.w5)((()=>[(0,s.Uk)("Título do produto")])),_:1}),(0,s.Wm)(ve,{scope:"col"},{default:(0,s.w5)((()=>[(0,s.Uk)("Quantidade")])),_:1}),(0,s.Wm)(ve,{scope:"col"},{default:(0,s.w5)((()=>[(0,s.Uk)("Preço unitário")])),_:1}),(0,s.Wm)(ve,{scope:"col"})])),_:1})])),_:1}),(0,s.Wm)(Se,null,{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(ae.form.products,((e,t)=>((0,s.wg)(),(0,s.j4)(ye,{key:t},{default:(0,s.w5)((()=>[(0,s.Wm)(ve,{scope:"row"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(t+1),1)])),_:2},1024),(0,s.Wm)(we,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(e.title),1)])),_:2},1024),(0,s.Wm)(we,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(e.quantity),1)])),_:2},1024),(0,s.Wm)(we,null,{default:(0,s.w5)((()=>[(0,s.Uk)("R$ "+(0,r.zw)(e.price.toFixed(2)),1)])),_:2},1024),(0,s.Wm)(we,null,{default:(0,s.w5)((()=>[(0,s.Wm)(me,{color:"light",onClick:t=>ie.removeProduct(e.id)},{default:(0,s.w5)((()=>[(0,s.Wm)(le,{icon:"cil-trash"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),(0,s.Wm)(ye,null,{default:(0,s.w5)((()=>[(0,s.Wm)(we,{colspan:4},{default:(0,s.w5)((()=>[A])),_:1}),(0,s.Wm)(we,{colspan:1},{default:(0,s.w5)((()=>[(0,s.Uk)("R$ "+(0,r.zw)(ie.calculateTotal),1)])),_:1})])),_:1})])),_:1})])),_:1})])):(0,s.kq)("",!0)])),void 0==ae.id||ae.endService?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",q,[(0,s._)("div",O,[(0,s._)("div",B,[(0,s.Wm)(me,{color:"danger",style:{color:"white"},onClick:t[10]||(t[10]=()=>{ae.endService=!ae.endService,1==ae.endService&&ie.carregarOptionsPaymentMethod()})},{default:(0,s.w5)((()=>[(0,s.Uk)("Finalizar Atendimento")])),_:1})])])])),1==ae.endService?((0,s.wg)(),(0,s.iD)("div",L,[(0,s._)("div",E,[(0,s._)("div",z,[(0,s.Wm)(de,null,{default:(0,s.w5)((()=>[(0,s.Uk)("* Forma de pagamento")])),_:1})])]),(0,s._)("div",j,[(0,s._)("div",H,[(0,s.Wm)(pe,{options:ae.optionsSelectPaymentMethod,searchable:!0,modelValue:ae.payment.paymentMethod.id,"onUpdate:modelValue":t[11]||(t[11]=e=>ae.payment.paymentMethod.id=e),disabled:ae.isItFinished},null,8,["options","modelValue","disabled"])])]),(0,s._)("div",N,[(0,s._)("div",R,[(0,s.Wm)(de,null,{default:(0,s.w5)((()=>[(0,s.Uk)("* Valor bruto")])),_:1}),(0,s.Wm)(fe,null,{default:(0,s.w5)((()=>[(0,s.Wm)(be,null,{default:(0,s.w5)((()=>[(0,s.Uk)("R$")])),_:1}),(0,s.Wm)(ce,{modelValue:ae.payment.grossvalue,"onUpdate:modelValue":t[12]||(t[12]=e=>ae.payment.grossvalue=e),disabled:ae.isItFinished,min:"0"},null,8,["modelValue","disabled"])])),_:1})]),(0,s._)("div",Y,[(0,s.Wm)(de,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Desconto")])),_:1}),(0,s.Wm)(fe,null,{default:(0,s.w5)((()=>[(0,s.Wm)(be,null,{default:(0,s.w5)((()=>[(0,s.Uk)("R$")])),_:1}),(0,s.Wm)(ce,{modelValue:ae.payment.discount,"onUpdate:modelValue":t[13]||(t[13]=e=>ae.payment.discount=e),disabled:ae.isItFinished,min:"0"},null,8,["modelValue","disabled"])])),_:1})]),(0,s._)("div",K,[(0,s.Wm)(de,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Valor total")])),_:1}),(0,s.Wm)(fe,null,{default:(0,s.w5)((()=>[(0,s.Wm)(be,null,{default:(0,s.w5)((()=>[(0,s.Uk)("R$")])),_:1}),(0,s.Wm)(ce,{modelValue:ae.payment.amount,"onUpdate:modelValue":t[14]||(t[14]=e=>ae.payment.amount=e),min:"0",disabled:!0},null,8,["modelValue"])])),_:1})])]),ae.isItFinished?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",Q,[(0,s._)("div",G,[void 0!=ae.form.client.loyaltyCard?((0,s.wg)(),(0,s.j4)(Ce,{key:0,card:ae.form.client.loyaltyCard,onApplyDiscount:ie.applyDiscount},null,8,["card","onApplyDiscount"])):(0,s.kq)("",!0)])])),ae.isItFinished?((0,s.wg)(),(0,s.iD)("div",J,ee)):(0,s.kq)("",!0)])):(0,s.kq)("",!0)])):((0,s.wg)(),(0,s.iD)("div",te,se))])):(0,s.kq)("",!0),(0,s._)("div",re,[ae.availableTimes.length>0&&!ae.isItFinished?((0,s.wg)(),(0,s.j4)(me,{key:0,color:"primary",class:"me-md-2",onClick:ie.formValidation},{default:(0,s.w5)((()=>[(0,s.Uk)("Confirmar")])),_:1},8,["onClick"])):(0,s.kq)("",!0),ae.isItFinished?((0,s.wg)(),(0,s.j4)(me,{key:1,color:"primary",class:"me-md-2",onClick:ie.reverseService},{default:(0,s.w5)((()=>[(0,s.Uk)("Estornar atendimento")])),_:1},8,["onClick"])):(0,s.kq)("",!0),oe])])),_:1})])),_:1})])),_:1})])),_:1}),(0,s.Wm)(We,{ref:"toast"},null,512),void 0!=ae.modalExcluir?((0,s.wg)(),(0,s.j4)(Pe,{key:0,modalExcluir:ae.modalExcluir,onConfirmeDelete:ie.deleteItem},null,8,["modalExcluir","onConfirmeDelete"])):(0,s.kq)("",!0)],64)}var le=a(5066),ne=a(6294),de=a(7853),ce=a(7749),ue=a(9068),me=a(8387),pe=a(964),he=a(5691);function fe(e,t,a,r,o,i){const l=(0,s.up)("CModalTitle"),n=(0,s.up)("CModalHeader"),d=(0,s.up)("CModalBody"),c=(0,s.up)("CButton"),u=(0,s.up)("CModalFooter"),m=(0,s.up)("CModal");return(0,s.wg)(),(0,s.j4)(m,{visible:a.modalExcluir,onClose:t[2]||(t[2]=()=>{a.modalExcluir=!1})},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{dismiss:"",onClose:t[0]||(t[0]=()=>{a.modalExcluir=!1})},{default:(0,s.w5)((()=>[(0,s.Wm)(l,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Deseja excluir esse item?")])),_:1})])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Uk)("O item será excluído permanentemente do banco de dados.")])),_:1}),(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(c,{color:"secondary",onClick:t[1]||(t[1]=()=>{a.modalExcluir=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("Cancelar")])),_:1}),(0,s.Wm)(c,{color:"primary",onClick:i.confirm},{default:(0,s.w5)((()=>[(0,s.Uk)("Confirmar")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["visible"])}const ve={name:"ModalDelete",props:{modalExcluir:{type:Boolean,required:!0}},data(){return{}},methods:{confirm(){this.$emit("confirmeDelete")}}};var ye=a(89);const ge=(0,ye.Z)(ve,[["render",fe]]),we=ge;var Se=a(1982),_e=a(6947),be=a(7693);const Ce={name:"Registrar Atendiemtno",components:{Toast:le.Z,Multiselect:ce.Z,ModalDelete:we,CFormLabel:_e.L8,LoyaltyCard:be.Z},data(){return{modalExcluir:!1,isItFinished:!1,dateNow:new he.Z,time:this.$route.params.time,id:this.$route.params.id,disabled:!1,disabledById:!1,date:"",pService:new ne.Z,prService:new de.Z,scheduleService:new me.Z,cServeice:new ue.Z,productService:new pe.Z,paymentMethodService:new Se.Z,endService:!1,form:{client:{id:""},startDate:"",endDate:"",professional:{id:""},procedures:[],products:[]},payment:{amount:0,discount:0,grossvalue:0,paymentMethod:{id:""}},profissionalSelected:{value:""},profissionalSelectedAux:"",customerSelected:{value:""},optionsSelectProfessional:[],optionsSelectProcedures:[],proceduresSelected:[],optionsSelectCustomer:[],optionsSelectProduct:[],optionsSelectPaymentMethod:[],availableTimes:[],startTime:"",product:{id:"",title:"",quantity:0,price:0},productSelected:""}},computed:{calculateTotal(){let e=parseFloat(0);for(const t of this.form.products)e+=t.price*t.quantity;return e.toFixed(2)},total(){return this.payment.grossvalue-this.payment.discount},timeService(){let e,t=[];for(const a of this.proceduresSelected)e=this.optionsSelectProcedures.find((e=>e.id==a.id)),t.push(e.duration);return this.calcularHorarioTotal(t)},priceProceduresSelected(){let e,t=0;for(const a of this.proceduresSelected)e=this.optionsSelectProcedures.find((e=>e.id==a.id)),t+=parseFloat(e.price);return t.toFixed(2)},labelTimeAvaliabel(){return void 0==this.id?"* Horários disponíveis":"* Horário do Atendimento"},titleCardHeader(){return void 0==this.id?"Registrar Agendamento":"Alterar Atendimento"}},watch:{priceProceduresSelected(e){this.payment.grossvalue=parseFloat(this.payment.grossvalue)+parseFloat(e)},calculateTotal(e){this.payment.grossvalue=parseFloat(this.payment.grossvalue)+parseFloat(e)},calculateTotal(e){this.payment.grossvalue=parseFloat(e)+parseFloat(this.priceProceduresSelected)},"payment.discount"(e){""==e?this.payment.discount=0:this.payment.amount=this.payment.grossvalue-parseFloat(e)},"payment.grossvalue"(e){this.payment.amount=parseFloat(e)}},methods:{async reverseService(){const e=await this.scheduleService.reverseService(this.id);200==e.status?window.location.reload():400==e.status&&this.$refs.toast.createToastDanger(e.message)},validForLaunchingProducts(){let e=!1;const t=this.dateNow.compareDates(this.date);return 0==t&&(e=!0),e},applyDiscount(e){this.payment.discount=e},async carregarOptionsPaymentMethod(){const e=await this.paymentMethodService.consultarFormasPagamento();this.optionsSelectPaymentMethod.push("Selecione uma opção");for(const t of e)this.optionsSelectPaymentMethod.push({value:t.id,label:t.description})},toCallModalDele(){this.modalExcluir=!0},async deleteItem(){const e=await this.scheduleService.delete(this.id);204==e.status?this.$router.push("/schedule/get"):400==e.status?this.$refs.toast.createToastDanger(e.message):this.$refs.toast.createToastDanger("Ocorreu um erro ao excluir o item")},removeProduct(e){let t=this.form.products.findIndex((t=>t.id===e));t>-1&&this.form.products.splice(t,1)},validationFinishService(){let e=!0;return this.payment.grossvalue<=0&&(e=!1,this.$refs.toast.createToastDanger("O valor bruto deve ser maior de 0")),""==this.payment.paymentMethod.id&&(e=!1,this.$refs.toast.createToastDanger("A forma de pagamento é obrigatória")),e},duplicateProductValidation(e){let t=this.form.products.find((t=>t.id==e.id));return t},validationAddProduct(){let e=!0;return""==this.productSelected&&(e=!1,this.$refs.toast.createToastDanger("Você deve selecionar um produto para poder adicionar")),this.product.quantity<=0&&(e=!1,this.$refs.toast.createToastDanger("A quantidade precisa ser maior que 0")),e},addProduct(){if(this.validationAddProduct()){let e={id:this.productSelected.value,title:this.productSelected.title,price:this.productSelected.price,quantity:this.product.quantity};void 0==this.duplicateProductValidation(e)?this.form.products.push(e):this.$refs.toast.createToastDanger("Não é permitido produtos duplicados")}},async carregarProductSelect(){let e=await this.productService.consultarTodos();e.forEach((e=>{this.optionsSelectProduct.push({value:e.id,label:`${e.title} - R$ ${e.price.toFixed(2)} Qtde: ${e.quantity}`,title:e.title,price:e.price})}))},calcularHorarioTotal(e){const t=e.reduce(((e,t)=>{const[a,s,r]=t.split(":");return e+3600*a+60*s+1*r}),0),a=Math.floor(t/3600),s=Math.floor(t%3600/60),r=t%60;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},changeDate(){if(""!=this.form.professional.id){const e=this.dateNow.compareDates(this.date);e>0?(this.$refs.toast.createToastDanger("A data do agendamento não pode ser maior que a data atual ou vazia!"),this.availableTimes=[]):this.searchSchedules()}},async searchSchedules(){this.adjustmentSelects();const e=await this.scheduleService.searchAvailable(this.date,this.form.professional.id);this.availableTimes=[],this.availableTimes.push("Selecione um horário"),e.forEach((e=>{this.availableTimes.push(e)})),this.searchProceduresProfessional(this.form.professional.id),this.carregarOptionsCustomer()},async searchProceduresProfessional(e){let t=await this.pService.buscarUm(e);const a=t.procedures;this.optionsSelectProcedures=[];for(const s of a)this.optionsSelectProcedures.push({value:s.id,description:s.description,duration:s.duration,price:s.price})},adjustmentSelects(){this.form.professional.id=this.profissionalSelected.value,this.form.client.id=this.customerSelected.value,this.form.procedures=[],this.proceduresSelected.forEach((e=>{this.form.procedures.push({id:e})}))},async carregarOptionsProfessional(){let e=await this.pService.consultarTodos();e.forEach((e=>{this.optionsSelectProfessional.push({value:e.id,label:e.name})}))},async carregarOptionsCustomer(){const e=await this.cServeice.consultarTodos();e.forEach((e=>{this.optionsSelectCustomer.push({value:e.id,label:e.name})}))},searchValidation(){let e=this.form,t=!0;this.adjustmentSelects(),""==e.professional.id&&(t=!1,this.$refs.toast.createToastDanger("Profissional é obrigatório")),""==this.date&&(t=!1,this.$refs.toast.createToastDanger("Data é obrigatória"));const a=this.dateNow.compareDates(this.date);a>0&&(t=!1,this.$refs.toast.createToastDanger("A data do agendamento não pode ser maior que a data atual ou vazia!")),t&&this.searchSchedules()},formValidation(){let e=!0;this.adjustmentSelects(),""==this.startTime&&(e=!1,this.$refs.toast.createToastDanger("Você deve selecionar um horário para agendamento")),0==this.form.procedures.length&&(e=!1,this.$refs.toast.createToastDanger("Você deve selecionar um ou mais procedimentos para o agendamento")),""==this.form.client.id&&(e=!1,this.$refs.toast.createToastDanger("Você deve selecionar o cliente para o agendamento")),this.endService&&(e=this.validationFinishService()),e&&this.save()},async save(){let e;e=void 0==this.id?await this.scheduleService.save(this.form,this.date,this.startTime):void 0!=this.id&&this.endService?await this.scheduleService.finishService(this.id,this.form,this.payment):await this.scheduleService.update(this.id,this.form,this.payment),console.log(`RES: ${JSON.stringify(e)}`),201==e.status?(this.$refs.toast.createToast("Atendimento registrado com sucesso!"),this.$router.push("/schedule/get")):200==e.status?(this.$refs.toast.createToast("Atendimento registrado com sucesso!"),this.endService&&this.$router.push("/schedule/get")):400==e.status?this.$refs.toast.createToastDanger(e.message):this.$refs.toast.createToastDanger("Ocorreu um erro ao registar agendamento!")},screenviaFullCalendar(){let e=this.time.split("T");this.date=e[0],e=e[1].split("-"),this.time=e[0],this.availableTimes.push(this.time),this.startTime=this.time,this.carregarOptionsCustomer(),this.carregarOptionsProfessional(),this.disabled=!0},handleSelectChange(){void 0!=this.time&&this.profissionalSelectedAux!=this.profissionalSelected.value&&(""!=this.profissionalSelected.value&&this.searchProceduresProfessional(this.profissionalSelected.value),this.profissionalSelectedAux=this.profissionalSelected.value)},async screenById(e){this.form=await this.scheduleService.getById(e),this.profissionalSelected.value=this.form.professional.id,this.profissionalSelected.label=this.form.professional.name,await this.searchProceduresProfessional(this.form.professional.id);for(const a of this.form.procedures)this.proceduresSelected.push(a.id);let t=this.form.startDate;t=t.split("T"),this.availableTimes.push(t[1]),this.startTime=t[1],this.date=t[0],this.customerSelected.value=this.form.client.id,this.customerSelected.label=this.form.client.name,this.disabled=!0,this.disabledById=!0,void 0!=this.form.payment.paymentMethod.id&&(this.endService=!0,await this.carregarOptionsPaymentMethod(),this.payment=this.form.payment,this.isItFinished=!0),this.carregarProductSelect(),this.validForLaunchingProducts()}},mounted(){this.date=this.dateNow.dateNowISO(),this.carregarOptionsProfessional(),void 0!=this.time&&this.screenviaFullCalendar(),void 0!=this.id&&this.screenById(this.id)}},$e=(0,ye.Z)(Ce,[["render",ie]]),ke=$e}}]);
//# sourceMappingURL=110.1d049aad.js.map