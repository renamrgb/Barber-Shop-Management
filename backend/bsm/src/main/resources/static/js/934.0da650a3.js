"use strict";(self["webpackChunkbsm"]=self["webpackChunkbsm"]||[]).push([[934],{8776:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(1505);class o{url="/stockEntry";async getAllPaged(e,t){try{const a=await r.Z.get(`${this.url}/paged?dtStart=${t.dtStart}&dtEnd=${t.dtEnd}&page=${e}`);return a.data}catch(a){return a}}async getById(e){try{const t=await r.Z.get(`${this.url}/${e}`);return t.data}catch(t){return t}}async getByDescriptionPaged(e,t,a){try{const o=await r.Z.get(`${this.url}/paged?dtStart=${a.dtStart}&dtEnd=${a.dtEnd}&supplier=${e}&page=${t}`);return o.data}catch(o){return o}}async save(e){try{const t=await r.Z.post(`${this.url}`,e);return t}catch(t){return t}}async reverse(e){try{const t=await r.Z.post(`${this.url}/reverse/${e}`);return t}catch(t){return t}}}},964:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(1505);class o{url="/products";async updateOrInsert(e,t){return void 0==e?await this.cadastrar(t):await this.alterar(e,t)}async consultarTodos(){try{const e=await r.Z.get(this.url);return e.data}catch(e){return e}}async getAllPaged(e,t){let a=`?page=${e}`;t&&(a=`?isActive=true&page=${e}`);try{const e=await r.Z.get(`${this.url}/productsPaged${a}`);return e.data}catch(o){return o}}async cadastrar(e){try{const t=await r.Z.post(this.url,e);return t}catch(t){return t}}async excluir(e){try{const t=await r.Z["delete"](`${this.url}/${e}`);return t}catch(t){return t}}async alterar(e,t){try{const a=await r.Z.put(`${this.url}/${e}`,t);return a}catch(a){return a}}async buscarUm(e){try{const t=await r.Z.get(`${this.url}/${e}`);return t.data}catch(t){return t}}async getByTitle(e){try{const t=await r.Z.get(`${this.url}?title=${e}`);return t.data}catch(t){return t}}async getByTitlePaged(e,t,a){let o="";a&&(o="&isActive=true");try{const a=await r.Z.get(`${this.url}/productsPaged?title=${e}${o}&page=${t}`);return a.data}catch(l){return l}}}},5066:(e,t,a)=>{a.d(t,{Z:()=>i});var r=a(3396),o=a(7139);function l(e,t,a,l,s,d){const u=(0,r.up)("CToastBody"),i=(0,r.up)("CToast"),c=(0,r.up)("CToaster");return(0,r.wg)(),(0,r.j4)(c,{placement:"top-end"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.toasts,((e,t)=>((0,r.wg)(),(0,r.j4)(i,{key:t,color:s.color},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r._)("b",null,(0,o.zw)(e.content),1)])),_:2},1024)])),_:2},1032,["color"])))),128))])),_:1})}const s={data(){return{toasts:[],color:"info"}},methods:{createToast(e){this.color="light",this.toasts.push({content:e})},createToastDanger(e){this.color="danger",this.toasts.push({content:e})},createToastWarning(e){this.color="warning",this.toasts.push({content:e})}}};var d=a(89);const u=(0,d.Z)(s,[["render",l]]),i=u},9934:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var r=a(3396),o=a(7139);const l=(0,r._)("strong",null,"Lançar produtos em estoque",-1),s={class:"row mb-3"},d={class:"col"},u={key:0,class:"row mb-3"},i={class:"col"},c={class:"col-2"},n={class:"col-2"},p={class:"col-1"},m=(0,r._)("br",null,null,-1),f={key:1,class:"bdr"},h={class:"row mb-3"},w={class:"col"},g={class:"col"},y={class:"col"},v={class:"col"},b={class:"row mb-3"},_={class:"col"},$={key:2,class:"row mb-3",style:{color:"red"}},k=(0,r._)("div",{class:"col",style:{"text-align":"center"}}," O Lançamento já foi estornado ",-1),W=[k],C={class:"d-grid gap-2 d-md-flex justify-content-md-end"},V=(0,r._)("a",{href:"/#/stock/listLaunchProducts",class:"btn btn-danger"},"Cancelar",-1);function T(e,t,a,k,T,U){const D=(0,r.up)("CCardHeader"),q=(0,r.up)("CFormLabel"),P=(0,r.up)("CFormInput"),Z=(0,r.up)("v-select"),S=(0,r.up)("CInputGroupText"),N=(0,r.up)("CInputGroup"),F=(0,r.up)("CIcon"),B=(0,r.up)("CButton"),I=(0,r.up)("CTableHeaderCell"),x=(0,r.up)("CTableRow"),j=(0,r.up)("CTableHead"),A=(0,r.up)("CTableDataCell"),O=(0,r.up)("CTableBody"),E=(0,r.up)("CTable"),z=(0,r.up)("CCardBody"),H=(0,r.up)("CCard"),R=(0,r.up)("CCol"),L=(0,r.up)("CRow"),Q=(0,r.up)("toast");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(L,null,{default:(0,r.w5)((()=>[(0,r.Wm)(R,{xs:12},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{class:"mb-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[l])),_:1}),(0,r.Wm)(z,null,{default:(0,r.w5)((()=>[(0,r._)("div",s,[(0,r._)("div",d,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Fornecedor")])),_:1}),(0,r.Wm)(P,{name:"nome",type:"text",modelValue:T.form.supplier,"onUpdate:modelValue":t[0]||(t[0]=e=>T.form.supplier=e),disabled:T.disabled},null,8,["modelValue","disabled"])])]),void 0==T.id?((0,r.wg)(),(0,r.iD)("div",u,[(0,r._)("div",i,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Produto")])),_:1}),(0,r.Wm)(Z,{id:"selectV",modelValue:T.productSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>T.productSelected=e),label:"label",options:T.optionsSelect},null,8,["modelValue","options"])]),(0,r._)("div",c,[(0,r.Wm)(q,{for:"price"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Preço")])),_:1}),(0,r.Wm)(N,{class:"mb-1"},{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Uk)("R$")])),_:1}),(0,r.Wm)(P,{price:"price",modelValue:T.product.price,"onUpdate:modelValue":t[2]||(t[2]=e=>T.product.price=e),min:"0"},null,8,["modelValue"])])),_:1})]),(0,r._)("div",n,[(0,r.Wm)(q,{for:"price"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Quantidade")])),_:1}),(0,r.Wm)(N,{class:"mb-1"},{default:(0,r.w5)((()=>[(0,r.Wm)(P,{name:"quantidade",type:"number",modelValue:T.product.quantity,"onUpdate:modelValue":t[3]||(t[3]=e=>T.product.quantity=e)},null,8,["modelValue"])])),_:1})]),(0,r._)("div",p,[m,(0,r.Wm)(B,{color:"info",shape:"rounded-pill",onClick:U.addProduct},{default:(0,r.w5)((()=>[(0,r.Wm)(F,{icon:"cil-plus",size:"x"})])),_:1},8,["onClick"])])])):(0,r.kq)("",!0),T.form.products.length>0?((0,r.wg)(),(0,r.iD)("div",f,[(0,r.Wm)(E,{responsive:"xl"},{default:(0,r.w5)((()=>[(0,r.Wm)(j,{class:"table-dark"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,null,{default:(0,r.w5)((()=>[(0,r.Wm)(I,{scope:"col"},{default:(0,r.w5)((()=>[(0,r.Uk)("#")])),_:1}),(0,r.Wm)(I,{scope:"col"},{default:(0,r.w5)((()=>[(0,r.Uk)("Título do produto")])),_:1}),(0,r.Wm)(I,{scope:"col"},{default:(0,r.w5)((()=>[(0,r.Uk)("Preço")])),_:1}),(0,r.Wm)(I,{scope:"col"},{default:(0,r.w5)((()=>[(0,r.Uk)("Quantidade")])),_:1}),(0,r.Wm)(I,{scope:"col"})])),_:1})])),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(this.form.products,((e,t)=>((0,r.wg)(),(0,r.j4)(x,{key:t},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{scope:"row"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.id),1)])),_:2},1024),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.title),1)])),_:2},1024),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[(0,r.Uk)("R$ "+(0,o.zw)(e.price),1)])),_:2},1024),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.quantity),1)])),_:2},1024),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[void 0==T.id?((0,r.wg)(),(0,r.j4)(B,{key:0,color:"light",onClick:e=>U.removeProduct(t)},{default:(0,r.w5)((()=>[(0,r.Wm)(F,{icon:"cil-trash"})])),_:2},1032,["onClick"])):(0,r.kq)("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])):(0,r.kq)("",!0),(0,r._)("div",h,[(0,r._)("div",w,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Data da compra")])),_:1}),(0,r.Wm)(P,{name:"Data da compra",type:"date",modelValue:T.form.nfe.dateofPurchase,"onUpdate:modelValue":t[4]||(t[4]=e=>T.form.nfe.dateofPurchase=e),disabled:T.disabled},null,8,["modelValue","disabled"])]),(0,r._)("div",g,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("N° da nota fiscal")])),_:1}),(0,r.Wm)(P,{name:"Numero da nfe",type:"number",modelValue:T.form.nfe.numberNfe,"onUpdate:modelValue":t[5]||(t[5]=e=>T.form.nfe.numberNfe=e),disabled:T.disabled},null,8,["modelValue","disabled"])]),(0,r._)("div",y,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("CFOP")])),_:1}),(0,r.Wm)(P,{name:"Cfop",type:"number",modelValue:T.form.nfe.cfop,"onUpdate:modelValue":t[6]||(t[6]=e=>T.form.nfe.cfop=e),disabled:T.disabled},null,8,["modelValue","disabled"])]),(0,r._)("div",v,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("* Valor da nota fiscal")])),_:1}),(0,r.Wm)(N,{class:"mb-1"},{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Uk)("R$")])),_:1}),(0,r.Wm)(P,{price:"price",modelValue:T.form.nfe.valueNfe,"onUpdate:modelValue":t[7]||(t[7]=e=>T.form.nfe.valueNfe=e),disabled:T.disabled},null,8,["modelValue","disabled"])])),_:1})])]),(0,r._)("div",b,[(0,r._)("div",_,[(0,r.Wm)(q,{for:"nome"},{default:(0,r.w5)((()=>[(0,r.Uk)("Chave")])),_:1}),(0,r.Wm)(P,{name:"chave",type:"text",modelValue:T.form.nfe.key,"onUpdate:modelValue":t[8]||(t[8]=e=>T.form.nfe.key=e),disabled:T.disabled},null,8,["modelValue","disabled"])])]),1==T.form.reversed?((0,r.wg)(),(0,r.iD)("div",$,W)):(0,r.kq)("",!0),(0,r._)("div",C,[T.id==e.un?((0,r.wg)(),(0,r.j4)(B,{key:0,color:"primary",class:"me-md-2",onClick:U.formValidation},{default:(0,r.w5)((()=>[(0,r.Uk)("Confirmar")])),_:1},8,["onClick"])):(0,r.kq)("",!0),V])])),_:1})])),_:1})])),_:1})])),_:1}),(0,r.Wm)(Q,{ref:"toast"},null,512)],64)}var U=a(5066),D=a(964),q=a(8776);const P={name:"Lançar Produtos",components:{Toast:U.Z},data(){return{id:this.$route.params.id,productService:new D.Z,optionsSelect:[],service:new q.Z,form:{reversed:void 0,supplier:"",products:[],nfe:{dateofPurchase:"",numberNfe:"",cfop:"",valueNfe:0,key:""}},product:{product:{id:""},title:"",price:0,quantity:0},disabled:!1,productSelected:""}},methods:{removeProduct(e){const t=this.form.products[e].price,a=this.form.products[e].quantity,r=parseFloat(t)*a;this.form.nfe.valueNfe=parseFloat(this.form.nfe.valueNfe)-parseFloat(r),this.form.products.pop(e)},addProduct(){let e=!0,t={product:{id:this.productSelected.value},title:this.product.title,price:this.product.price,quantity:this.product.quantity};if(""==t.product.id)this.$refs.toast.createToastDanger("Selecionar o produto é obrigatório"),e=!1;else{let e=function(e){return e.value==t.product.id},a=this.optionsSelect.find(e);t.title=a.title}(""==t.price||t.price<=0)&&(this.$refs.toast.createToastDanger("O preço do produto deve ser maior que 0"),e=!1),t.quantity<=0&&(this.$refs.toast.createToastDanger("A quantidade deve ser maior que 0"),e=!1);const a=this.validateDuplicateProduct(t.product.id);void 0==a?e&&(this.form.nfe.valueNfe=this.addValueNfe(t.price,t.quantity),t.price=parseFloat(t.price),this.form.products.push(t),this.product={product:{id:""},title:"",price:0,quantity:0},this.productSelected=""):this.$refs.toast.createToastDanger(`O produto ${a.title} já está na lista e não é permitido duplicidade!`)},addValueNfe(e,t){let a=parseFloat(this.form.nfe.valueNfe);return a+=parseFloat(e)*t,a},async carregarOptionsSelect(){let e=await this.productService.consultarTodos();e.forEach((e=>{this.optionsSelect.push({value:e.id,label:`${e.title} - R$ ${e.price.toFixed(2)} Qtde: ${e.quantity}`,title:e.title,price:e.price})}))},formValidation(){let e=this.form,t=!0;""==e.supplier&&(t=!1,this.$refs.toast.createToastDanger("Fornecedor é obrigatório")),0==e.products.length&&(t=!1,this.$refs.toast.createToastDanger("É obrigatório selecionar pelo menos um produto")),""==e.dateofPurchase&&(t=!1,this.$refs.toast.createToastDanger("A data da compra é obrigatória"));const a=new Date,r=new Date(this.form.nfe.dateofPurchase);let o=r.getTime()-a.getTime(),l=Math.round(o/864e5);console.log(l),l<=-7&&(t=!1,this.$refs.toast.createToastDanger("A data da compra não pode ser menor que o período de uma semana")),l>-0&&(t=!1,this.$refs.toast.createToastDanger("A data da compra não pode ser maior que a data atual")),e.valueNfe<=0&&(t=!1,this.$refs.toast.createToastDanger("Valor da NFE deve ser maior que 0")),t&&this.salvar()},async salvar(){let e=await this.service.save(this.form);201==e.status?this.$refs.toast.createToast("Produtos(s) lançados com sucesso."):this.$refs.toast.createToastDanger("Ocorreu um erro ao lançar o produto")},validateDuplicateProduct(e){const t=this.form.products.find((t=>t.product.id==e));return t},disabladInpluts(){this.disabled=!0},async getById(e){this.form=await this.service.getById(e),console.log(this.form.reversed)}},mounted(){this.carregarOptionsSelect(),void 0!=this.id&&(this.disabladInpluts(),this.getById(this.id))}};var Z=a(89);const S=(0,Z.Z)(P,[["render",T]]),N=S}}]);
//# sourceMappingURL=934.0da650a3.js.map